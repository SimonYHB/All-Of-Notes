## 多线程

ptread、NSThread、GCD、NSOperationQueue

group&notify、barrier、semaphore

### Q

- 多线程的方案

- performSelector...afterDelay

  performSelector...afterDelay用的是定时器，会添加到runloop中，在子线程执行时，要保证子线程有开启runloop才会执行

- GCD的队列类型

- OperationQueue和GCD的区别

- 线程安全的处理手段

- OC的锁

  - 自旋锁 OSSpinLock

    - 不安全，由于线程调度可能出现优先级反转问题，优先级低的先加锁了，优先级高的一直在忙等，cpu切不到优先级低的线程执行内容，导致死锁

  - 互斥锁 等待的时候会处于休眠状态

    - os_unfair_lock  
    - pthread_mutex 也支持递归锁、条件锁(cond)
      - NSLock是对其互斥锁的封装

  - 递归锁 允许一个线程对同一把锁进行多次加锁

    - NSRecursiveLock 对mutex递归锁的封装
    - @synchronized  对mutex递归锁的封装8

  - 条件锁

    - NSCondition 对mutex和cond的封装
    - NSConditionLock 可设置条件值

  - GDC

    - 串行队列
    - semaphore

  - atomic修饰

    - Get/set原子性操作
    - 不能保证属性操作时线程安全（例如属性为数组，修改数组内的元素）

    

- 死锁

  往**当前串行队列**添加**sync**任务会产生死锁





- 文件多线程读写安全
  - 可以同时读，但是只能单独写
  - 实现方式
    - pthread_rwlock_x 互斥锁
    - Dispatch_barrier_async

